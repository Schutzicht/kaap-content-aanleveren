---
import Layout from '../layouts/Layout.astro';
---

<Layout title="KAAP Content Aanleveren">
    <div class="space-y-10 reveal active">
        <div class="text-center space-y-4">
            <div class="inline-block px-4 py-1.5 rounded-full bg-white border border-gray-200 text-sm font-semibold text-kaap-purple mb-2 shadow-sm">
                Voor intern gebruik
            </div>
            <h1 class="text-4xl md:text-5xl font-heading font-bold text-kaap-gray leading-tight">
                Deel jouw <span class="text-kaap-gradient">Content Idee</span>
            </h1>
            <p class="text-kaap-text-gray text-lg max-w-2xl mx-auto leading-relaxed">
                Heb je een innovatief project, event of mijlpaal te delen? Vul dit formulier in (max 2 min) en stuur het direct door.
            </p>
        </div>

        <form id="submissionForm" class="bg-white p-8 md:p-10 rounded-3xl shadow-xl shadow-gray-200/50 border border-gray-100 space-y-8 relative overflow-hidden">
            <!-- Top shimmer effect -->
            <div class="absolute top-0 left-0 w-full h-1 bg-kaap-gradient"></div>

            <!-- Wat? -->
            <div class="space-y-2">
                <label for="wat" class="block font-heading font-semibold text-kaap-gray text-lg">Wat? <span class="text-kaap-pink">*</span></label>
                <p class="text-sm text-kaap-text-gray mb-2">Korte titel of onderwerp van je update.</p>
                <input type="text" id="wat" name="wat" required
                    class="w-full px-5 py-4 rounded-xl bg-gray-50 border-2 border-transparent focus:bg-white focus:border-kaap-pink/50 focus:ring-4 focus:ring-kaap-pink/10 outline-none transition-all duration-300 font-medium placeholder-gray-400"
                    placeholder="Bijv: Opening nieuw lab..." />
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <!-- Waar? -->
                <div class="space-y-2">
                    <label for="waar" class="block font-heading font-semibold text-kaap-gray text-lg">Waar?</label>
                    <input type="text" id="waar" name="waar"
                        class="w-full px-5 py-4 rounded-xl bg-gray-50 border-2 border-transparent focus:bg-white focus:border-kaap-pink/50 focus:ring-4 focus:ring-kaap-pink/10 outline-none transition-all duration-300 font-medium placeholder-gray-400"
                        placeholder="Bijv: Vlissingen / Online" />
                </div>

                <!-- Waarom? -->
                <div class="space-y-2">
                    <label for="waarom" class="block font-heading font-semibold text-kaap-gray text-lg">Waarom? (Doel)</label>
                    <input type="text" id="waarom" name="waarom"
                        class="w-full px-5 py-4 rounded-xl bg-gray-50 border-2 border-transparent focus:bg-white focus:border-kaap-pink/50 focus:ring-4 focus:ring-kaap-pink/10 outline-none transition-all duration-300 font-medium placeholder-gray-400"
                        placeholder="Bijv: Kennis delen, Werving..." />
                </div>
            </div>

            <!-- Wanneer plaatsen? -->
            <div class="space-y-3">
                <label class="block font-heading font-semibold text-kaap-gray text-lg">Wanneer plaatsen? <span class="text-kaap-pink">*</span></label>
                <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
                    <label class="cursor-pointer relative">
                        <input type="radio" name="timing" value="Spoed" class="peer sr-only" required>
                        <div class="p-3 rounded-xl bg-gray-50 border-2 border-transparent peer-checked:border-kaap-pink peer-checked:bg-kaap-pink/5 hover:bg-gray-100 transition-all text-center font-medium text-kaap-gray">
                            üî• Spoed
                        </div>
                    </label>
                    <label class="cursor-pointer relative">
                        <input type="radio" name="timing" value="Deze week" class="peer sr-only">
                        <div class="p-3 rounded-xl bg-gray-50 border-2 border-transparent peer-checked:border-kaap-pink peer-checked:bg-kaap-pink/5 hover:bg-gray-100 transition-all text-center font-medium text-kaap-gray">
                            üìÖ Deze week
                        </div>
                    </label>
                    <label class="cursor-pointer relative">
                        <input type="radio" name="timing" value="Geen haast" class="peer sr-only">
                        <div class="p-3 rounded-xl bg-gray-50 border-2 border-transparent peer-checked:border-kaap-pink peer-checked:bg-kaap-pink/5 hover:bg-gray-100 transition-all text-center font-medium text-kaap-gray">
                            ‚òï Geen haast
                        </div>
                    </label>
                    <label class="cursor-pointer relative col-span-2 md:col-span-3">
                        <input type="radio" name="timing" value="Anders" class="peer sr-only" id="timingCustom">
                        <div class="p-3 rounded-xl bg-gray-50 border-2 border-transparent peer-checked:border-kaap-pink peer-checked:bg-kaap-pink/5 hover:bg-gray-100 transition-all text-center font-medium text-kaap-gray flex flex-wrap items-center justify-center gap-2">
                             <span>‚úèÔ∏è Zelf kiezen:</span>
                             <input type="date" name="customDate" class="bg-transparent border-b border-gray-300 focus:border-kaap-pink outline-none text-sm px-1 min-w-[120px]" onclick="document.getElementById('timingCustom').checked = true">
                        </div>
                    </label>
                </div>
            </div>

            <!-- Met welke partners? -->
            <div class="space-y-2">
                <label for="partners" class="block font-heading font-semibold text-kaap-gray text-lg">Met welke partners? <span class="text-kaap-pink">*</span></label>
                <p class="text-sm text-kaap-text-gray mb-2">Wie moeten we taggen of noemen?</p>
                <input type="text" id="partners" name="partners" required
                    class="w-full px-5 py-4 rounded-xl bg-gray-50 border-2 border-transparent focus:bg-white focus:border-kaap-pink/50 focus:ring-4 focus:ring-kaap-pink/10 outline-none transition-all duration-300 font-medium placeholder-gray-400"
                    placeholder="@Partner1, @Partner2..." />
            </div>

            <!-- Toelichting voor content -->
            <div class="space-y-2">
                <div class="flex items-center justify-between">
                    <label for="toelichting" class="block font-heading font-semibold text-kaap-gray text-lg">Toelichting voor content</label>
                    <button type="button" id="micButton" class="text-kaap-gray hover:text-kaap-pink transition-colors p-2 rounded-full hover:bg-gray-100 hidden group-focus-within:block" title="Spreek toelichting in">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 18.75a6 6 0 0 0 6-6v-1.5m-6 7.5a6 6 0 0 1-6-6v-1.5m6 7.5v3.75m-3.75 0h7.5M12 15.75a3 3 0 0 1-3-3V4.5a3 3 0 1 1 6 0v8.25a3 3 0 0 1-3 3Z" />
                        </svg>
                    </button>
                </div>
                <p class="text-sm text-kaap-text-gray mb-2">Het verhaal in het kort.</p>
                <div class="relative">
                    <textarea id="toelichting" name="toelichting" rows="3"
                        class="w-full px-5 py-4 rounded-xl bg-gray-50 border-2 border-transparent focus:bg-white focus:border-kaap-pink/50 focus:ring-4 focus:ring-kaap-pink/10 outline-none transition-all duration-300 font-medium placeholder-gray-400 resize-none"
                        placeholder="Typ hier je toelichting..."></textarea>
                    <div id="micStatus" class="absolute top-2 right-2 hidden">
                        <span class="flex h-3 w-3">
                            <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"></span>
                            <span class="relative inline-flex rounded-full h-3 w-3 bg-red-500"></span>
                        </span>
                    </div>
                </div>
            </div>

            <!-- Foto's/video's -->
            <div class="space-y-2">
                <label for="media" class="block font-heading font-semibold text-kaap-gray text-lg">Foto's / Video's</label>
                <p class="text-sm text-kaap-text-gray mb-2">Heb je beeld? Plak een linkje of voeg ze toe als bijlage in de mail.</p>
                <input type="text" id="media" name="media"
                    class="w-full px-5 py-4 rounded-xl bg-gray-50 border-2 border-transparent focus:bg-white focus:border-kaap-pink/50 focus:ring-4 focus:ring-kaap-pink/10 outline-none transition-all duration-300 font-medium placeholder-gray-400"
                    placeholder="Link naar bestanden (optioneel)" />
            </div>

             <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <!-- Partnerinput/contactpersoon -->
                <div class="space-y-2">
                    <label for="contact" class="block font-heading font-semibold text-kaap-gray text-lg">Contactpersoon</label>
                    <input type="text" id="contact" name="contact"
                        class="w-full px-5 py-4 rounded-xl bg-gray-50 border-2 border-transparent focus:bg-white focus:border-kaap-pink/50 focus:ring-4 focus:ring-kaap-pink/10 outline-none transition-all duration-300 font-medium placeholder-gray-400"
                        placeholder="Naam / Organisatie" />
                </div>

                <!-- Verplichtingen -->
                 <div class="space-y-2">
                    <label for="verplichtingen" class="block font-heading font-semibold text-kaap-gray text-lg">Verplichtingen</label>
                    <input type="text" id="verplichtingen" name="verplichtingen"
                        class="w-full px-5 py-4 rounded-xl bg-gray-50 border-2 border-transparent focus:bg-white focus:border-kaap-pink/50 focus:ring-4 focus:ring-kaap-pink/10 outline-none transition-all duration-300 font-medium placeholder-gray-400"
                        placeholder="Logo's, embargo's, etc." />
                </div>
            </div>

            <div class="pt-4">
                <button type="submit" 
                    class="group w-full bg-kaap-gray hover:bg-black text-white font-heading font-bold text-lg py-5 rounded-xl shadow-lg hover:shadow-2xl hover:shadow-kaap-pink/20 transform hover:-translate-y-1 transition-all duration-300 flex items-center justify-center gap-2">
                    <span>Open in Email</span>
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="size-5 group-hover:translate-x-1 transition-transform">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 12 3.269 3.125A59.769 59.769 0 0 1 21.485 12 59.768 59.768 0 0 1 3.27 20.875L5.999 12Zm0 0h7.5" />
                    </svg>                      
                </button>
                <p class="text-center text-xs text-kaap-text-gray mt-4">
                    Dit opent je standaard mailprogramma. Vergeet bijlagen niet handmatig toe te voegen!
                </p>
            </div>
        </form>
    </div>
</Layout>

<script>
    const form = document.getElementById('submissionForm') as HTMLFormElement;
    
    // Voice to Text Logic
    const micButton = document.getElementById('micButton');
    const micStatus = document.getElementById('micStatus');
    const toelichtingInput = document.getElementById('toelichting') as HTMLTextAreaElement;
    
    // Check browser support
    if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
        micButton?.classList.remove('hidden');
        
        // @ts-ignore
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        const recognition = new SpeechRecognition();
        
        recognition.continuous = false;
        recognition.lang = 'nl-NL';
        recognition.interimResults = false;
        
        recognition.onstart = () => {
            micButton?.classList.add('text-red-500', 'animate-pulse');
            micStatus?.classList.remove('hidden');
        };
        
        recognition.onend = () => {
            micButton?.classList.remove('text-red-500', 'animate-pulse');
            micStatus?.classList.add('hidden');
        };
        
        recognition.onresult = (event: any) => {
            const transcript = event.results[0][0].transcript;
            if (toelichtingInput) {
                const currentText = toelichtingInput.value;
                toelichtingInput.value = currentText ? `${currentText} ${transcript}` : transcript;
            }
        };
        
        micButton?.addEventListener('click', () => {
            recognition.start();
        });
    } else {
        console.log('Web Speech API not supported in this browser.');
    }
    
    form?.addEventListener('submit', (e) => {
        e.preventDefault();
        
        const formData = new FormData(form);
        const data = Object.fromEntries(formData);
        
        const timingVal = data.timing === 'Anders' && data.customDate ? `Datum: ${data.customDate}` : data.timing;

        // Helper to convert text to sans-serif bold unicode (like the example)
        const toBoldSans = (text: string) => {
            const map: {[key: string]: string} = {
                'A': 'ùóî', 'B': 'ùóï', 'C': 'ùóñ', 'D': 'ùóó', 'E': 'ùóò', 'F': 'ùóô', 'G': 'ùóö', 'H': 'ùóõ', 'I': 'ùóú', 'J': 'ùóù', 'K': 'ùóû', 'L': 'ùóü', 'M': 'ùó†', 'N': 'ùó°', 'O': 'ùó¢', 'P': 'ùó£', 'Q': 'ùó§', 'R': 'ùó•', 'S': 'ùó¶', 'T': 'ùóß', 'U': 'ùó®', 'V': 'ùó©', 'W': 'ùó™', 'X': 'ùó´', 'Y': 'ùó¨', 'Z': 'ùó≠',
                'a': 'ùóÆ', 'b': 'ùóØ', 'c': 'ùó∞', 'd': 'ùó±', 'e': 'ùó≤', 'f': 'ùó≥', 'g': 'ùó¥', 'h': 'ùóµ', 'i': 'ùó∂', 'j': 'ùó∑', 'k': 'ùó∏', 'l': 'ùóπ', 'm': 'ùó∫', 'n': 'ùóª', 'o': 'ùóº', 'p': 'ùóΩ', 'q': 'ùóæ', 'r': 'ùóø', 's': 'ùòÄ', 't': 'ùòÅ', 'u': 'ùòÇ', 'v': 'ùòÉ', 'w': 'ùòÑ', 'x': 'ùòÖ', 'y': 'ùòÜ', 'z': 'ùòá'
            };
            return text.split('').map(char => map[char] || char).join('');
        };

        // Auto-generate Social Media Draft (KAAP Style)
        const headline = `üé¨ ${toBoldSans(data.wat || 'Nieuws Update')}`;
        
        const socialDraft = `
${headline}

${data.toelichting || '(Korte toelichting...)'}

üí° ${data.waarom ? `Dit biedt kansen voor... ${data.waarom}` : 'Samen zetten we stappen in de toekomst van innovatie in Zeeland.'}

üìÖ Wil jij ook stappen zetten of samenwerken?
Neem contact op met ${data.contact || 'ons'} of kom langs bij KAAP.

Met dank aan onze partners:
${data.partners}

#KAAP #Innovatie #Zeeland`.trim();

        const subject = `Content Idee: ${data.wat}`;
        const body = `
Beste Jorik & Phaedra,

Hierbij een nieuw content idee vanuit de organisatie.

========================================
ONDERWERP
${data.wat}
========================================

WANNEER PLAATSEN
${timingVal}

LOCATIE
${data.waar || '-'}

BETROKKEN PARTNERS
${data.partners}

DOEL / WAAROM
${data.waarom || '-'}

----------------------------------------

TOELICHTING
${data.toelichting || '-'}

BEELDMATERIAAL
${data.media || '(Zie eventuele bijlage)'}

CONTACTPERSOON
${data.contact || '-'}

VERPLICHTINGEN / EMBARGO
${data.verplichtingen || 'Geen'}

----------------------------------------
CONCEPT SOCIAL POST (KAAP STIJL)
----------------------------------------
${socialDraft}
----------------------------------------

Met vriendelijke groet,
        `.trim();

        window.location.href = `mailto:jorik@dockwize.nl,phaedra@dockwize.nl?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
    });
</script>
